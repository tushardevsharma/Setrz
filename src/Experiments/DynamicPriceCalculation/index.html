<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setrz Co. Dynamic Pricing Engine</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e6;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- CONSTANTS & CONFIGURATION ---
        
        // Base Inventory items with standard volumes (Cubic Feet - CFT)
        const ITEM_CATALOG = [
            { id: 'box_s', name: 'Small Box', cft: 3, icon: 'fa-box' },
            { id: 'box_l', name: 'Large Box', cft: 5, icon: 'fa-box-open' },
            { id: 'chair', name: 'Chair', cft: 10, icon: 'fa-chair' },
            { id: 'desk', name: 'Desk', cft: 25, icon: 'fa-table' },
            { id: 'bed_q', name: 'Queen Bed', cft: 60, icon: 'fa-bed' },
            { id: 'sofa_3', name: 'Sofa (3-Seater)', cft: 50, icon: 'fa-couch' },
            { id: 'fridge', name: 'Refrigerator', cft: 40, icon: 'fa-snowflake' },
            { id: 'wardrobe', name: 'Wardrobe', cft: 70, icon: 'fa-door-closed' }
        ];

        // Truck Tiers
        const TRUCKS = [
            { name: 'Lite (Pickup)', capacity: 200, baseCost: 1500, perKm: 20 },
            { name: 'Standard (14ft)', capacity: 600, baseCost: 3500, perKm: 35 },
            { name: 'Mega (17ft)', capacity: 1000, baseCost: 5500, perKm: 50 },
            { name: 'Fleet (20ft+)', capacity: 9999, baseCost: 8000, perKm: 65 }
        ];

        // Labor & Complexity Costs
        const LABOR_RATE_PER_CFT = 8; // Cost to pack/load 1 cft
        const FLOOR_SURCHARGE_PCT = 0.10; // 10% extra per floor if no lift

        function App() {
            // --- STATE ---
            const [inventory, setInventory] = useState({});
            const [distance, setDistance] = useState(15); // km
            const [moveDate, setMoveDate] = useState(new Date().toISOString().split('T')[0]);
            
            // Access details
            const [originFloor, setOriginFloor] = useState(1);
            const [originLift, setOriginLift] = useState(true);
            const [destFloor, setDestFloor] = useState(1);
            const [destLift, setDestLift] = useState(true);

            // --- ACTIONS ---
            const updateInventory = (itemId, change) => {
                setInventory(prev => {
                    const current = prev[itemId] || 0;
                    const updated = Math.max(0, current + change);
                    return { ...prev, [itemId]: updated };
                });
            };

            // --- PRICING ENGINE LOGIC ---

            const calculations = useMemo(() => {
                // 1. Calculate Total Volume
                let totalCFT = 0;
                let itemCount = 0;
                Object.entries(inventory).forEach(([id, count]) => {
                    const item = ITEM_CATALOG.find(i => i.id === id);
                    if (item) {
                        totalCFT += item.cft * count;
                        itemCount += count;
                    }
                });

                // Default volume if empty to avoid 0 logic issues
                const calcCFT = Math.max(totalCFT, 1); 

                // 2. Select Truck Tier
                const selectedTruck = TRUCKS.find(t => t.capacity >= calcCFT) || TRUCKS[TRUCKS.length - 1];

                // 3. Transport Cost
                const transportCost = selectedTruck.baseCost + (distance * selectedTruck.perKm);

                // 4. Labor Cost (Packing & Handling)
                // Base labor + complexity scaling
                const laborCost = calcCFT * LABOR_RATE_PER_CFT;

                // 5. Access Complexity (Stairs)
                // If no lift, add percentage based on floor number (Ground = 0)
                let accessMultiplier = 1;
                let stairsSurcharge = 0;

                if (!originLift && originFloor > 0) {
                    const extra = transportCost * (originFloor * FLOOR_SURCHARGE_PCT);
                    stairsSurcharge += extra;
                }
                if (!destLift && destFloor > 0) {
                    const extra = transportCost * (destFloor * FLOOR_SURCHARGE_PCT);
                    stairsSurcharge += extra;
                }

                // 6. Dynamic Date Factors (Demand)
                const dateObj = new Date(moveDate);
                const day = dateObj.getDay(); // 0 = Sun, 6 = Sat
                const dateOfMonth = dateObj.getDate();
                const month = dateObj.getMonth(); // 0-11

                let dynamicFactors = [];
                let demandMultiplier = 1.0;

                // Weekend Surge
                if (day === 0 || day === 6) {
                    demandMultiplier += 0.15; // +15%
                    dynamicFactors.push({ label: 'Weekend Surge', amount: '+15%' });
                }

                // Month-End Surge (Last 5 days of month)
                // Simple logic: if date > 25
                if (dateOfMonth > 25) {
                    demandMultiplier += 0.20; // +20%
                    dynamicFactors.push({ label: 'Month-End Demand', amount: '+20%' });
                }

                // 7. Final Totals
                const subTotal = transportCost + laborCost + stairsSurcharge;
                const finalTotal = subTotal * demandMultiplier;

                return {
                    totalCFT,
                    itemCount,
                    selectedTruck,
                    transportCost,
                    laborCost,
                    stairsSurcharge,
                    demandMultiplier,
                    dynamicFactors,
                    subTotal,
                    finalTotal
                };
            }, [inventory, distance, moveDate, originFloor, originLift, destFloor, destLift]);


            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <div className="bg-indigo-900 text-white p-6 shadow-lg">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold">The Setrz Co. <span className="text-indigo-300 font-light">| Engine</span></h1>
                                <p className="text-sm opacity-80">Dynamic Pricing Algorithm Prototype v1.0</p>
                            </div>
                            <div className="mt-4 md:mt-0 bg-white/10 px-4 py-2 rounded-lg backdrop-blur-sm">
                                <span className="text-xs uppercase tracking-wider opacity-75">Status</span>
                                <div className="flex items-center gap-2 font-semibold">
                                    <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                                    Online
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto mt-8 px-4 grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        {/* LEFT COLUMN: Inputs */}
                        <div className="lg:col-span-2 space-y-6">
                            
                            {/* 1. Inventory */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    <i className="fa-solid fa-boxes-stacked mr-2 text-indigo-600"></i> Inventory
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {ITEM_CATALOG.map(item => (
                                        <div key={item.id} className="flex items-center justify-between p-3 border rounded-lg hover:border-indigo-200 transition-colors">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600">
                                                    <i className={`fa-solid ${item.icon}`}></i>
                                                </div>
                                                <div>
                                                    <p className="font-medium text-gray-900">{item.name}</p>
                                                    <p className="text-xs text-gray-500">{item.cft} cu ft</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <button onClick={() => updateInventory(item.id, -1)} className="w-8 h-8 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200">-</button>
                                                <span className="w-4 text-center font-bold">{inventory[item.id] || 0}</span>
                                                <button onClick={() => updateInventory(item.id, 1)} className="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-200">+</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* 2. Logistics & Date */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    <i className="fa-solid fa-truck-fast mr-2 text-indigo-600"></i> Logistics
                                </h2>
                                
                                <div className="space-y-6">
                                    <div>
                                        <label className="flex justify-between text-sm font-medium text-gray-700 mb-2">
                                            <span>Distance</span>
                                            <span className="text-indigo-600 font-bold">{distance} km</span>
                                        </label>
                                        <input 
                                            type="range" 
                                            min="1" max="500" 
                                            value={distance} 
                                            onChange={(e) => setDistance(parseInt(e.target.value))}
                                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Move Date</label>
                                        <input 
                                            type="date" 
                                            value={moveDate}
                                            onChange={(e) => setMoveDate(e.target.value)}
                                            className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Try selecting a Weekend or month-end (25th+) to see dynamic pricing.</p>
                                    </div>
                                </div>
                            </div>

                            {/* 3. Access Conditions */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    <i className="fa-solid fa-stairs mr-2 text-indigo-600"></i> Access Conditions
                                </h2>
                                <div className="grid grid-cols-2 gap-8">
                                    {/* Origin */}
                                    <div>
                                        <h3 className="text-xs font-bold uppercase text-gray-500 mb-3">Origin</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="text-sm text-gray-600 block mb-1">Floor Number</label>
                                                <div className="flex items-center gap-2 bg-gray-50 p-1 rounded-lg border border-gray-200">
                                                    <button 
                                                        onClick={() => setOriginFloor(Math.max(0, originFloor - 1))} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-md bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 active:scale-95 transition-all"
                                                    >
                                                        <i className="fa-solid fa-minus text-xs"></i>
                                                    </button>
                                                    <span className="flex-1 text-center font-medium text-gray-700 text-sm">
                                                        {originFloor === 0 ? 'Ground' : `Floor ${originFloor}`}
                                                    </span>
                                                    <button 
                                                        onClick={() => setOriginFloor(originFloor + 1)} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-md bg-indigo-600 border border-indigo-600 text-white hover:bg-indigo-700 active:scale-95 transition-all"
                                                    >
                                                        <i className="fa-solid fa-plus text-xs"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <input 
                                                    type="checkbox" 
                                                    checked={originLift} 
                                                    onChange={(e) => setOriginLift(e.target.checked)}
                                                    id="originLift"
                                                    className="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"
                                                />
                                                <label htmlFor="originLift" className="text-sm text-gray-700 cursor-pointer select-none">Elevator Available</label>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Destination */}
                                    <div>
                                        <h3 className="text-xs font-bold uppercase text-gray-500 mb-3">Destination</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="text-sm text-gray-600 block mb-1">Floor Number</label>
                                                <div className="flex items-center gap-2 bg-gray-50 p-1 rounded-lg border border-gray-200">
                                                    <button 
                                                        onClick={() => setDestFloor(Math.max(0, destFloor - 1))} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-md bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 active:scale-95 transition-all"
                                                    >
                                                        <i className="fa-solid fa-minus text-xs"></i>
                                                    </button>
                                                    <span className="flex-1 text-center font-medium text-gray-700 text-sm">
                                                        {destFloor === 0 ? 'Ground' : `Floor ${destFloor}`}
                                                    </span>
                                                    <button 
                                                        onClick={() => setDestFloor(destFloor + 1)} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-md bg-indigo-600 border border-indigo-600 text-white hover:bg-indigo-700 active:scale-95 transition-all"
                                                    >
                                                        <i className="fa-solid fa-plus text-xs"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <input 
                                                    type="checkbox" 
                                                    checked={destLift} 
                                                    onChange={(e) => setDestLift(e.target.checked)}
                                                    id="destLift"
                                                    className="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"
                                                />
                                                <label htmlFor="destLift" className="text-sm text-gray-700 cursor-pointer select-none">Elevator Available</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        {/* RIGHT COLUMN: Quote Engine */}
                        <div className="lg:col-span-1">
                            <div className="sticky top-6 bg-white rounded-xl shadow-lg border border-indigo-100 overflow-hidden">
                                <div className="bg-gray-50 p-4 border-b border-gray-100">
                                    <h2 className="font-bold text-gray-800">Quote Breakdown</h2>
                                </div>

                                <div className="p-6 space-y-4">
                                    {/* Volume Summary */}
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-gray-600">Total Volume</span>
                                        <span className="font-medium">{calculations.totalCFT} cu ft</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-gray-600">Vehicle Type</span>
                                        <span className="font-medium text-indigo-600">{calculations.selectedTruck.name}</span>
                                    </div>

                                    <hr className="border-dashed border-gray-200 my-2"/>

                                    {/* Base Costs */}
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-gray-600">Transport (Base + Dist)</span>
                                        <span>₹{Math.round(calculations.transportCost).toLocaleString()}</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm">
                                        <span className="text-gray-600">Labor & Handling</span>
                                        <span>₹{Math.round(calculations.laborCost).toLocaleString()}</span>
                                    </div>
                                    {calculations.stairsSurcharge > 0 && (
                                        <div className="flex justify-between items-center text-sm text-amber-600">
                                            <span><i className="fa-solid fa-triangle-exclamation mr-1"></i> Stairs Surcharge</span>
                                            <span>+₹{Math.round(calculations.stairsSurcharge).toLocaleString()}</span>
                                        </div>
                                    )}

                                    {/* Dynamic Factors */}
                                    {calculations.dynamicFactors.length > 0 && (
                                        <div className="bg-indigo-50 p-3 rounded-lg mt-2">
                                            <p className="text-xs font-bold text-indigo-800 uppercase mb-2">Dynamic Adjustments</p>
                                            {calculations.dynamicFactors.map((f, i) => (
                                                <div key={i} className="flex justify-between items-center text-xs text-indigo-700 mb-1">
                                                    <span>{f.label}</span>
                                                    <span className="font-bold">{f.amount}</span>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    <div className="pt-4 mt-4 border-t border-gray-100">
                                        <div className="flex justify-between items-end">
                                            <span className="text-gray-500 font-medium">Estimated Total</span>
                                            <span className="text-3xl font-bold text-gray-900">₹{Math.round(calculations.finalTotal).toLocaleString()}</span>
                                        </div>
                                        <p className="text-xs text-right text-gray-400 mt-1">Excludes taxes & insurance</p>
                                    </div>

                                    <button className="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                                        <span>Save Quote</span>
                                        <i className="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            {/* Debug / Insights Panel */}
                            <div className="mt-6 p-4 bg-gray-800 rounded-xl text-gray-300 text-xs font-mono">
                                <p className="uppercase text-gray-500 font-bold mb-2">Engine Logic Output</p>
                                <div className="space-y-1">
                                    <div className="flex justify-between"><span>Base Rate:</span> <span>₹{calculations.selectedTruck.baseCost}</span></div>
                                    <div className="flex justify-between"><span>Dist Rate:</span> <span>₹{calculations.selectedTruck.perKm}/km</span></div>
                                    <div className="flex justify-between"><span>Demand Multiplier:</span> <span>{calculations.demandMultiplier.toFixed(2)}x</span></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>