<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="logo">Zeeroni</div>
    <div class="user-profile">
      <img src="https://via.placeholder.com/40" alt="User Avatar" class="avatar" />
      <button class="logout-button" (click)="logout()">Logout</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <h2>Video Survey Upload</h2>

    <!-- Custom File Name Input -->
    <div class="form-group custom-file-name-input">
      <label for="customFileName">Custom File Name (Optional)</label>
      <input
        id="customFileName"
        type="text"
        [(ngModel)]="customFileName"
        placeholder="Enter a custom name for your video"
      />
    </div>

    <!-- Upload Area -->
    <div
      class="upload-area"
      (dragover)="$event.preventDefault()"
      (drop)="onFileDropped($event)"
      (click)="fileInput.click()"
    >
      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        multiple
        hidden
        accept="video/*"
      />
      <p>Drag and drop your video surveys here, or click to select files.</p>
      <p class="small-text">Supported formats: MP4, MOV, AVI</p>
    </div>

    <!-- Survey List -->
    <div class="survey-list">
      <h3>Recent Uploads</h3>
      <div *ngIf="isLoadingUploads" class="loading-spinner-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading uploads...</span>
        </div>
        <p>Loading uploads...</p>
      </div>
      <ng-container *ngIf="!isLoadingUploads">
        <div class="upload-item-card" *ngFor="let upload of uploads">
          <div class="item-details">
            <span class="video-name">{{ upload.videoName }}</span>
            <span class="timestamp">{{ upload.createdTimestamp | date: 'short' }}</span>
          </div>
          <div class="item-status">
            <span class="status-badge" [ngClass]="getStatusClass(upload.status)">
              {{ upload.status }}
            </span>
            <div class="progress-bar-container" *ngIf="upload.status === 'Pending' || upload.status === 'Processing'">
              <div class="progress-bar" [style.width.%]="upload.progress"></div>
            </div>
          </div>
          <div class="item-actions">
            <button
              *ngIf="upload.status === 'Completed'"
              class="action-button primary-button"
              (click)="openDigitalManifest(upload.uploadId)"
            >
              Get Digital Manifest
            </button>
            <button
              *ngIf="upload.status === 'Failed'"
              class="action-button retry-button"
            >
              Retry
            </button>
          </div>
        </div>
        <p *ngIf="uploads.length === 0" class="no-uploads">No uploads yet.</p>
      </ng-container>
    </div>
  </main>
</div>

<!-- Digital Manifest Modal -->
<app-digital-manifest-modal
  *ngIf="isModalOpen"
  [manifestData]="selectedManifest"
  (closeModal)="closeDigitalManifest()"
>
  <div *ngIf="isLoadingManifest" class="modal-loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading manifest...</span>
    </div>
    <p>Loading manifest...</p>
  </div>
</app-digital-manifest-modal>
